app-id: io.emeric.watchflower
runtime: org.freedesktop.Platform
runtime-version: '21.08'
sdk: org.freedesktop.Sdk
command: watchflower

rename-desktop-file: watchflower.desktop
rename-appdata-file: watchflower.appdata.xml
rename-icon: watchflower

finish-args:
  # Our UI is GPU accelerated
  - --device=dri
  # X11 + XShm access
  - --share=ipc
  - --socket=fallback-x11
  # Wayland access
  - --socket=wayland
  # We need Bluetooth support
  - --allow=bluetooth
  - --system-talk-name=org.bluez
  - --share=network

cleanup:
  - /bin/__pypache__
  - /bin/rst*
  - /include
  - /lib/cmake
  - /lib/cups
  - /lib/pkgconfig
  - /lib/python*
  - /share/doc
  - /share/man
  - /share/zsh
  - /src
  - '*.a'
  - '*.la'

build-options:
  append-ld-library-path: /app/lib

modules:
  - name: libical # required by bluez
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DBUILD_SHARED_LIBS:BOOL=ON
      - -DICAL_GLIB=true
      - -DGOBJECT_INTROSPECTION=true
      - -DICAL_GLIB_VAPI=true
      - -DICAL_BUILD_DOCS=false
      - -DICAL_GLIB_VAPI=false
    sources:
      - type: archive
        url: https://github.com/libical/libical/archive/v3.0.16.tar.gz
        sha256: b44705dd71ca4538c86fb16248483ab4b48978524fb1da5097bd76aa2e0f0c33
        x-checker-data:
          type: anitya
          project-id: 1637
          url-template: https://github.com/libical/libical/archive/v$version.tar.gz
  - name: bluez # required by qtconnectivity
    buildsystem: autotools
    config-opts:
      - --disable-tools
      - --disable-cups
      - --disable-monitor
      - --disable-client
      - --disable-systemd
      - --disable-udev
      - --disable-manpages
      - --disable-datafiles
      - --enable-experimental
      - --enable-library
      - --prefix=/app
      - --sysconfdir=/app/etc
    sources:
      - type: archive
        url: https://www.kernel.org/pub/linux/bluetooth/bluez-5.66.tar.xz
        sha256: 39fea64b590c9492984a0c27a89fc203e1cdc74866086efb8f4698677ab2b574
        x-checker-data:
          type: anitya
          project-id: 10029
          url-template: https://www.kernel.org/pub/linux/bluetooth/bluez-$version.tar.xz

  - name: qt-base
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DQT_BUILD_EXAMPLES=OFF
      - -DQT_BUILD_TESTS=OFF
    sources:
      - type: archive
        url: https://download.qt.io/archive/qt/6.4/6.4.3/submodules/qtbase-everywhere-src-6.4.3.tar.xz
        sha256: 5087c9e5b0165e7bc3c1a4ab176b35d0cd8f52636aea903fa377bdba00891a60
        x-checker-data:
          type: anitya
          project-id: 7927
          stable-only: true
          url-template: https://download.qt.io/archive/qt/$major.$minor/$version/submodules/qtbase-everywhere-src-$version.tar.xz
    cleanup:
      - /bin

  - name: qt-tools
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_PREFIX_PATH=/app
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DQT_BUILD_EXAMPLES=OFF
      - -DQT_BUILD_TESTS=OFF
    sources:
      - type: archive
        url: https://download.qt.io/archive/qt/6.4/6.4.3/submodules/qttools-everywhere-src-6.4.3.tar.xz
        sha256: 867df829cd5cd3ae8efe62e825503123542764b13c96953511e567df70c5a091
        x-checker-data:
          type: anitya
          project-id: 7927
          stable-only: true
          url-template: https://download.qt.io/archive/qt/$major.$minor/$version/submodules/qttools-everywhere-src-$version.tar.xz

  - name: qt-shadertools
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DQT_BUILD_EXAMPLES=OFF
      - -DQT_BUILD_TESTS=OFF
    sources:
      - type: archive
        url: https://download.qt.io/archive/qt/6.4/6.4.3/submodules/qtshadertools-everywhere-src-6.4.3.tar.xz
        sha256: c648b74ce3e769a20bd62792a589c540bceacfedf2f38fc7273d2c39782768f8
        x-checker-data:
          type: anitya
          project-id: 7927
          stable-only: true
          url-template: https://download.qt.io/archive/qt/$major.$minor/$version/submodules/qtshadertools-everywhere-src-$version.tar.xz

  - name: qtdeclarative
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_PREFIX_PATH=/app
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DQT_BUILD_EXAMPLES=OFF
      - -DQT_BUILD_TESTS=OFF
    sources:
      - type: archive
        url: https://download.qt.io/archive/qt/6.4/6.4.3/submodules/qtdeclarative-everywhere-src-6.4.3.tar.xz
        sha256: 67ded1b3b988135e3600916b34bb156fe3986c88420c6f87a6d0fd53521ba795
        x-checker-data:
          type: anitya
          project-id: 7927
          stable-only: true
          url-template: https://download.qt.io/archive/qt/$major.$minor/$version/submodules/qtdeclarative-everywhere-src-$version.tar.xz

  - name: qtwayland
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DQT_BUILD_EXAMPLES=OFF
      - -DQT_BUILD_TESTS=OFF
    sources:
      - type: archive
        url: https://download.qt.io/archive/qt/6.4/6.4.3/submodules/qtwayland-everywhere-src-6.4.3.tar.xz
        sha256: c6b161da8f4c01e48c10b7b558a0a01ac07dba9b907b13a98ff5d89f46bc4789
        x-checker-data:
          type: anitya
          project-id: 7927
          stable-only: true
          url-template: https://download.qt.io/archive/qt/$major.$minor/$version/submodules/qtwayland-everywhere-src-$version.tar.xz
    cleanup:
      - /bin

  - name: qtimageformats
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DQT_BUILD_EXAMPLES=OFF
      - -DQT_BUILD_TESTS=OFF
    sources:
      - type: archive
        url: https://download.qt.io/archive/qt/6.4/6.4.3/submodules/qtimageformats-everywhere-src-6.4.3.tar.xz
        sha256: 0aff58062e74b84617c5da8325d8cdad5368d8f4d2a11ceafcd58329fe99b798
        x-checker-data:
          type: anitya
          project-id: 7927
          stable-only: true
          url-template: https://download.qt.io/archive/qt/$major.$minor/$version/submodules/qtimageformats-everywhere-src-$version.tar.xz

  - name: qtsvg
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DQT_BUILD_EXAMPLES=OFF
      - -DQT_BUILD_TESTS=OFF
    sources:
      - type: archive
        url: https://download.qt.io/archive/qt/6.4/6.4.3/submodules/qtsvg-everywhere-src-6.4.3.tar.xz
        sha256: 88315f886cf81898705e487cedba6e6160724359d23c518c92c333c098879a4a
        x-checker-data:
          type: anitya
          project-id: 7927
          stable-only: true
          url-template: https://download.qt.io/archive/qt/$major.$minor/$version/submodules/qtsvg-everywhere-src-$version.tar.xz

  - name: qtconnectivity
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DQT_BUILD_EXAMPLES=OFF
      - -DQT_BUILD_TESTS=OFF
    sources:
      - type: archive
        url: https://download.qt.io/archive/qt/6.4/6.4.3/submodules/qtconnectivity-everywhere-src-6.4.3.tar.xz
        sha256: f98c2014cc4ab7ed69e762ecddd2433b95468942bb1612f648a7e9c94ba44c9d
        x-checker-data:
          type: anitya
          project-id: 7927
          stable-only: true
          url-template: https://download.qt.io/archive/qt/$major.$minor/$version/submodules/qtconnectivity-everywhere-src-$version.tar.xz

  - name: qtcharts
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DQT_BUILD_EXAMPLES=OFF
      - -DQT_BUILD_TESTS=OFF
    sources:
      - type: archive
        url: https://download.qt.io/archive/qt/6.4/6.4.3/submodules/qtcharts-everywhere-src-6.4.3.tar.xz
        sha256: 4a61e4f5ffb55df69fc58f88255aabca44fb51935b180c03ab81e098d437c346
        x-checker-data:
          type: anitya
          project-id: 7927
          stable-only: true
          url-template: https://download.qt.io/archive/qt/$major.$minor/$version/submodules/qtcharts-everywhere-src-$version.tar.xz

  - name: qt5compat
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DQT_BUILD_EXAMPLES=OFF
      - -DQT_BUILD_TESTS=OFF
    sources:
      - type: archive
        url: https://download.qt.io/archive/qt/6.4/6.4.3/submodules/qt5compat-everywhere-src-6.4.3.tar.xz
        sha256: d4b249abb823d575eee9045c24d924ba8d1276e6be7735b287689991d998aa7a
        x-checker-data:
          type: anitya
          project-id: 7927
          stable-only: true
          url-template: https://download.qt.io/archive/qt/$major.$minor/$version/submodules/qt5compat-everywhere-src-$version.tar.xz

  - name: watchflower
    buildsystem: qmake
    sources:
      - type: archive
        url: https://github.com/emericg/WatchFlower/archive/refs/tags/v4.1.tar.gz
        sha256: b8df8c1eecddc8f378f7be3450c7b5599704c3ad14b722bbccba9a6bd85ae58e
