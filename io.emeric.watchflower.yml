app-id: io.emeric.watchflower
runtime: org.freedesktop.Platform
runtime-version: '21.08'
sdk: org.freedesktop.Sdk
command: watchflower

rename-desktop-file: watchflower.desktop
rename-appdata-file: watchflower.appdata.xml
rename-icon: watchflower

finish-args:
  # Our UI is GPU accelerated
  - --device=dri
  # X11 + XShm access
  - --share=ipc
  - --socket=fallback-x11
  # Wayland access
  - --socket=wayland
  # We need Bluetooth support
  - --allow=bluetooth
  - --system-talk-name=org.bluez
  - --share=network

cleanup:
  - /bin/__pypache__
  - /bin/rst*
  - /include
  - /lib/cmake
  - /lib/cups
  - /lib/pkgconfig
  - /lib/python*
  - /share/doc
  - /share/man
  - /share/zsh
  - /src
  - '*.a'
  - '*.la'

build-options:
  append-ld-library-path: /app/lib

modules:
  - name: libical # required by bluez
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DBUILD_SHARED_LIBS:BOOL=ON
      - -DICAL_GLIB=true
      - -DGOBJECT_INTROSPECTION=true
      - -DICAL_GLIB_VAPI=true
      - -DICAL_BUILD_DOCS=false
      - -DICAL_GLIB_VAPI=false
    sources:
      - type: archive
        url: https://github.com/libical/libical/archive/v3.0.16.tar.gz
        sha256: b44705dd71ca4538c86fb16248483ab4b48978524fb1da5097bd76aa2e0f0c33
        x-checker-data:
          type: anitya
          project-id: 1637
          url-template: https://github.com/libical/libical/archive/v$version.tar.gz
  - name: bluez # required by qtconnectivity
    buildsystem: autotools
    config-opts:
      - --disable-tools
      - --disable-cups
      - --disable-monitor
      - --disable-client
      - --disable-systemd
      - --disable-udev
      - --disable-manpages
      - --disable-datafiles
      - --enable-experimental
      - --enable-library
      - --prefix=/app
      - --sysconfdir=/app/etc
    sources:
      - type: archive
        url: https://www.kernel.org/pub/linux/bluetooth/bluez-5.66.tar.xz
        sha256: 39fea64b590c9492984a0c27a89fc203e1cdc74866086efb8f4698677ab2b574
        x-checker-data:
          type: anitya
          project-id: 10029
          url-template: https://www.kernel.org/pub/linux/bluetooth/bluez-$version.tar.xz

  - name: qt-base
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DQT_BUILD_EXAMPLES=OFF
      - -DQT_BUILD_TESTS=OFF
    sources:
      - type: archive
        url: https://download.qt.io/archive/qt/6.4/6.4.1/submodules/qtbase-everywhere-src-6.4.1.tar.xz
        sha256: 532ad71cc0f9c8f7cb92766c47bc3d23263c60876becd9053802f9727af24fae
        x-checker-data:
          type: anitya
          project-id: 7927
          stable-only: true
          url-template: https://download.qt.io/archive/qt/$major.$minor/$version/submodules/qtbase-everywhere-src-$version.tar.xz
    cleanup:
      - /bin

  - name: qt-tools
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_PREFIX_PATH=/app
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DQT_BUILD_EXAMPLES=OFF
      - -DQT_BUILD_TESTS=OFF
    sources:
      - type: archive
        url: https://download.qt.io/archive/qt/6.3/6.3.1/submodules/qttools-everywhere-src-6.3.1.tar.xz
        sha256: c412750f2aa3beb93fce5f30517c607f55daaeb7d0407af206a8adf917e126c1
        x-checker-data:
          type: anitya
          project-id: 7927
          stable-only: true
          url-template: https://download.qt.io/archive/qt/$major.$minor/$version/submodules/qttools-everywhere-src-$version.tar.xz

  - name: qt-shadertools
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DQT_BUILD_EXAMPLES=OFF
      - -DQT_BUILD_TESTS=OFF
    sources:
      - type: archive
        url: https://download.qt.io/archive/qt/6.4/6.4.1/submodules/qtshadertools-everywhere-src-6.4.1.tar.xz
        sha256: 6bc1748326088c87f562fa3a68140e33fde162fd1333fbfecb775aeb66114504
        x-checker-data:
          type: anitya
          project-id: 7927
          stable-only: true
          url-template: https://download.qt.io/archive/qt/$major.$minor/$version/submodules/qtshadertools-everywhere-src-$version.tar.xz

  - name: qtdeclarative
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_PREFIX_PATH=/app
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DQT_BUILD_EXAMPLES=OFF
      - -DQT_BUILD_TESTS=OFF
    sources:
      - type: archive
        url: https://download.qt.io/archive/qt/6.4/6.4.1/submodules/qtdeclarative-everywhere-src-6.4.1.tar.xz
        sha256: af8c485fdb938dda26c4140d246821b7d8c8715024e1441f3f947bd5ac684dfe
        x-checker-data:
          type: anitya
          project-id: 7927
          stable-only: true
          url-template: https://download.qt.io/archive/qt/$major.$minor/$version/submodules/qtdeclarative-everywhere-src-$version.tar.xz

  - name: qtwayland
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DQT_BUILD_EXAMPLES=OFF
      - -DQT_BUILD_TESTS=OFF
    sources:
      - type: archive
        url: https://download.qt.io/archive/qt/6.4/6.4.1/submodules/qtwayland-everywhere-src-6.4.1.tar.xz
        sha256: 9c961645d1c1d420613bdf28eb5de3cc4b77bdadc636b6129ea282bfb069f2d5
        x-checker-data:
          type: anitya
          project-id: 7927
          stable-only: true
          url-template: https://download.qt.io/archive/qt/$major.$minor/$version/submodules/qtwayland-everywhere-src-$version.tar.xz
    cleanup:
      - /bin

  - name: qtimageformats
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DQT_BUILD_EXAMPLES=OFF
      - -DQT_BUILD_TESTS=OFF
    sources:
      - type: archive
        url: https://download.qt.io/archive/qt/6.3/6.3.1/submodules/qtimageformats-everywhere-src-6.3.1.tar.xz
        sha256: ad0312b8dfbbb67f729bfadbfcd47246ee4a128b717731ba158c41d01fde212f
        x-checker-data:
          type: anitya
          project-id: 7927
          stable-only: true
          url-template: https://download.qt.io/archive/qt/$major.$minor/$version/submodules/qtimageformats-everywhere-src-$version.tar.xz

  - name: qtsvg
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DQT_BUILD_EXAMPLES=OFF
      - -DQT_BUILD_TESTS=OFF
    sources:
      - type: archive
        url: https://download.qt.io/archive/qt/6.4/6.4.1/submodules/qtsvg-everywhere-src-6.4.1.tar.xz
        sha256: 5e5345c5941567db883f9daf8ab25108c6f3a527453b1a13c62290849bce9ce5
        x-checker-data:
          type: anitya
          project-id: 7927
          stable-only: true
          url-template: https://download.qt.io/archive/qt/$major.$minor/$version/submodules/qtsvg-everywhere-src-$version.tar.xz

  - name: qtconnectivity
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DQT_BUILD_EXAMPLES=OFF
      - -DQT_BUILD_TESTS=OFF
    sources:
      - type: archive
        url: https://download.qt.io/archive/qt/6.4/6.4.1/submodules/qtconnectivity-everywhere-src-6.4.1.tar.xz
        sha256: 9b0f5dbefd4fe4fe7048bf353f0dbc2db2a3fb4d0307c80c3c6bf292768fbbe3
        x-checker-data:
          type: anitya
          project-id: 7927
          stable-only: true
          url-template: https://download.qt.io/archive/qt/$major.$minor/$version/submodules/qtconnectivity-everywhere-src-$version.tar.xz

  - name: qtcharts
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DQT_BUILD_EXAMPLES=OFF
      - -DQT_BUILD_TESTS=OFF
    sources:
      - type: archive
        url: https://download.qt.io/archive/qt/6.4/6.4.1/submodules/qtcharts-everywhere-src-6.4.1.tar.xz
        sha256: dee8bcd61cffcab9350a4e1038bd0aa31ea5b023b948b4e4063d4cf0caa48f67
        x-checker-data:
          type: anitya
          project-id: 7927
          stable-only: true
          url-template: https://download.qt.io/archive/qt/$major.$minor/$version/submodules/qtcharts-everywhere-src-$version.tar.xz

  - name: qt5compat
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DQT_BUILD_EXAMPLES=OFF
      - -DQT_BUILD_TESTS=OFF
    sources:
      - type: archive
        url: https://download.qt.io/archive/qt/6.3/6.3.1/submodules/qt5compat-everywhere-src-6.3.1.tar.xz
        sha256: a43ec62bd778eaecf88ad7847118d1c2a471b0fcb820f93beb311d7ab9566cfd
        x-checker-data:
          type: anitya
          project-id: 7927
          stable-only: true
          url-template: https://download.qt.io/archive/qt/$major.$minor/$version/submodules/qt5compat-everywhere-src-$version.tar.xz

  - name: watchflower
    buildsystem: qmake
    sources:
      - type: archive
        url: https://github.com/emericg/WatchFlower/archive/refs/tags/v4.1.tar.gz
        sha256: b8df8c1eecddc8f378f7be3450c7b5599704c3ad14b722bbccba9a6bd85ae58e
